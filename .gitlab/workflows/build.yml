          name: Build & SonarCloud

          on:
            push:
              branches:
                - main
            pull_request:
              types: [ opened, synchronize, reopened ]

          jobs:
            build-and-analyze:
              name: Build, Test, SonarCloud
              runs-on: windows-latest

              steps:
                - uses: actions/checkout@v4
                  with:
                    fetch-depth: 0  # important for SonarCloud analysis

                - name: Setup Node
                  uses: actions/setup-node@v4
                  with:
                    node-version: 20

                - name: Install dependencies
                  run: npm ci

                - name: Run tests with coverage
                  run: npm test

                - name: SonarCloud Scan
                  uses: SonarSource/sonarcloud-github-action@v3
                  env:
                    SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
                  with:
                    args: >
                      -Dsonar.projectKey=adeliergiyev_qa-qc-process
                      -Dsonar.organization=alexandrdeliergiyevqa
                      -Dsonar.javascript.lcov.reportPaths=coverage/lcov.info
                      -Dsonar.sources=src
                      -Dsonar.tests=src
                      -Dsonar.test.inclusions=**/*.spec.ts
                      -Dsonar.exclusions=**/node_modules/**,**/dist/**

